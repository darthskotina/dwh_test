# Моделирование и SQL запросы
## Введение
В хранилище данных планируется загрузить данные из 2-х систем с общими справочниками. При регистрации, клиенту присваивается уникальный идентификатор ([UUID](https://postgrespro.ru/docs/postgresql/13/datatype-uuid)), дата и время регистрации проставляется автоматически системой в [UTC](https://en.wikipedia.org/wiki/Coordinated_Universal_Time).

После регистрации у клиента есть возможность открыть демо и реальные счета для совершения торговых операций. При открытии любого счета система автоматически присваивает дату и время создания в UTC.

Ордер - это торговая операция продажи или покупку какого-либо актива. Торговой операцией считается завершенная транзакция, которая имеет дату и время закрытия. Даты операции сохраняются в формате UTC.

**Для решения задачи, аналитиком команды, на начальном этапе анализа после встречи с продуктовой командой, были подготовлены прототипы сырых структур данных, в которые планируется регулярно выгружать данные. Данные структуры добавлены в репозиторий Git с комментариями и описаны на PostgreSQL. Кроме того, из kafka были получены выгрузки примеров данных для построение модели и потоков данных. Данные загружены в директорию [`source`](./source).**

## Постановка задачи
### Моделирование
0. Опцинально: Создать таблицы и загрузить в них данные из [`source`](./source). Примечание: структуры можно изменять для удобной работы с механизмами загрузок данных.

2. Спроектировать объекты хранилища данных для эффективного хранения детальных данных, и выборки при построении аналитических запросов конечными потребителями.

### SQL запросы
1. Необходимо написать запрос для пользовательского отчета, который выводит первые 3 депозита каждого реального счета клиента (в виде представления). Отчет должен содержать следующие поля: user_uid, account, operation_date, порядковый номер депозита.

2. Необходимо написать запрос для пользовательского отчета, который отобразит количество всех клиентов по странам, у которых средний депозит больше >= 1000 на текущий момент. Отчет должен содержать следующие поля: country, количество клиентов в стране, количество клиентов у которых депозит >= 1000.

# Вспомогательные материалы
* [PostgreSQL 13 Документация (рус)](https://postgrespro.ru/docs/postgresql/13)
* [PostgreSQL 13 Documentation (eng)](https://www.postgresql.org/docs/13/index.html)
